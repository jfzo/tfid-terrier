### TF-ID

#### Overall description

**TRECIndexing** class executes the method index() of the indexer object (Abstract class Indexer). Within this procedure, two abstract methods are called:

1. createDirectIndex( Collections[] )  that receives an array of collections
2. createInvertedIndex( )

The _createDirectIndex( C[] )_ method visits each document in every collection in _C_ . Then for each one, it extracts and filters the terms by means of  **TermPipeline** objects. 

When starting the processing of a document, a new **DocumenPostingList** is created. After each document is processed together with its extracted terms as mentioned above, both entities are indexed by calling the method **indexDocument( doc,  termsInDoc )**.

_indexDocument( … )_ is generally a protected method and as its commentary describes: “it adds the document to the direct and document indexes, as well as its terms to the lexicon” .

####  Goals

The first goal consists in modifying Terrier to be able to build term sequences for  a collection. This goal will be achieved by replacing pipeline classes and filtering out stop word and stemmed tokens before the document indexation process has begun. 

The second goal consists in modifying Terrier to be able to replace document-term-frequencies by the term degrees computed by the docgraph utilities. This goal will be addressed by creating new **Indexer**, **Collection** and **Document** classes capable of consuming terms and their counts from the CSV file generated by  _docgraph_ . Then, inside the _createDirectIndex_ method, the _termsInDoc_ object (**DocumentPostingList** object) will be modified by replacing every term frequency within the document by its corresponding term degree in the document-biterm-net.

### Running instructions
#### Generating the term sequence for each document 

Before building term-nets, the sequence of terms made up by stopwords and stemmed terms needs to be extracted. Additionally, great care must be taken since the vocabulary of Terrier index and the biterm-nets should match perfectly.

In this task the customization consisted in the creation of and **Indexer** class named **BasicIndexerAndTermSequencer** and two pipelines, i.e. Stopwords and PorterStemmer, defined inside the **BasicIndexerAndTermSequencer** class. 

The **BasicIndexerAndTermSequencer** class allows to index the collection just as the **BasicIndexer** does, but also dumps a term sequence (after preprocessing each term) corresponding to each document to an output file.

The two inner pipeline classes perform the same action as their corresponding siblings defined in **BasicIndexer** class, but they also append each stopword and stemmed token to a global vector. This vector is finally employed to build the term sequence already mentioned.

The list of term sequences written in the output file will be later employed by the _docgraph_ utils to build the biterm-nets and degrees files. In order to prefer this indexer instead of the default one, the option **-Dtrec.indexer.class= BasicIndexerAndTermSequencer** must be used when indexing, i.e. the following command should be executed:

```
$bin/bin/trec_terrier.sh -i -Dtrec.indexer.class= BasicIndexerAndTermSequencer
```
The output of the previous command will be in first place an index (see _./var/index_ folder) and a file named term_sequence.csv which will contain in each line the term sequence corresponding to a document. The first field in each line denotes the documento name.

#### Computing and indexing TW 

After the file containing each term degree in each document-biterm-net was generated, those term-degrees (in, out or its sum) must be indexed instead of the term frequency in each document. By design, Terrier does not allow this operation to be performed. Hence, a custom **Indexer**, **Collection** and **Document** classes must be created.

The class **BasicIndexerForDegrees** inherits most code from the **BasicIndexer** class. The customization made was the implementation of method _createDirectIndex( … )_ . The other customization was the creation of **Collection** class **DegreeByDocCollection**. This class allows to consume tokens from the CSV file generated by _docgraph_ utils. This class also employed a custom **Document** implementation consisting of the **DegreesDocument** class.

Relying on these three classes, the _CSV_ file can be processed in short times, replacing also the term-frequency in each doc by its (already computed) degree. Additionally, the in-degree , out-degree or its sum can be used in this part by adjusting the getter method calling in procedure _createDirectIndex_ of **BasicIndexerForDegrees** class.

In order to use the **BasicIndexerForDegrees** class instead of the default indexer in Terrier, the following command in the terminal console:

_The indexed degree value was artificially increased in one unit because it is unfeasible to index in Terrier a degree with value equal to 0, and also those 0-degree terms must be counted._

```
$ bin/trec_terrier.sh -i -Dtrec.indexer.class=BasicIndexerForDegrees -Dtrec.document.class=org.terrier.indexing.DegreesDocument -Dtrec.collection.class=DegreeByDocCollection -Dsinglefile.path=biterm_degrees_bydoc.csv
```

### Compilation instructions

*First* you need [Apache-ant](http://ant.apache.org/) and all the libraries of terrier into the **lib** directory. *Then* execute:
````
$ ant jar
```
The classpath is automatically pointed to the _lib_ directory. A file named _TFID.jar_ will be generated into the _lib_ directory. Finally, copy this jar file into Terrier's _lib_ directory.

### Using with Terrier
You need Terrier 4.0 installed and with the _TFID.jar_ file already in its _lib_ directory. Now Terrier can be run as usually following the running instructions of the previous part of this document.
